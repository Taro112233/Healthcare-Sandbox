// prisma/schemas/request.prisma
// ===== REQUEST SYSTEM SCHEMA - HealthTech Sandbox =====

model Request {
  id                String        @id @default(cuid())
  
  // Requester
  userId            String
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Request Content
  painPoint         String        @db.Text
  currentWorkflow   String        @db.Text
  expectedTechHelp  String        @db.Text
  requestType       RequestType
  
  // Status
  status            RequestStatus @default(PENDING_REVIEW)
  
  // Timestamps
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  // Relations
  attachments       Attachment[]
  comments          Comment[]
  statusHistory     StatusHistory[]
  
  @@index([userId])
  @@index([status])
  @@index([requestType])
  @@index([createdAt])
  @@map("requests")
}

model StatusHistory {
  id          String        @id @default(cuid())
  
  // Request relation
  requestId   String
  request     Request       @relation(fields: [requestId], references: [id], onDelete: Cascade)
  
  // Status transition
  fromStatus  RequestStatus
  toStatus    RequestStatus
  
  // Changed by (Admin)
  changedBy   String
  user        User          @relation(fields: [changedBy], references: [id], onDelete: Cascade)
  
  // Optional note
  note        String?       @db.Text
  
  // Timestamp
  changedAt   DateTime      @default(now())
  
  @@index([requestId])
  @@index([changedAt])
  @@map("status_history")
}

enum RequestType {
  CALCULATOR
  FORM
  WORKFLOW
  DECISION_AID
  OTHER
}

enum RequestStatus {
  PENDING_REVIEW
  UNDER_CONSIDERATION
  IN_DEVELOPMENT
  IN_TESTING
  COMPLETED
  BEYOND_CAPACITY
}